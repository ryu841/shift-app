<%= javascript_importmap_tags "delete_modal" %>

<div class="grid grid-cols-7 gap-6 w-3/5">
  <div class="space-y-6 col-span-4">
    <label class="block text-xl font-bold text-gray-700">募集シフト一覧</label>
    <% if @shifts.present? %>
      <% @shifts.each do |shift| %>
        <div>
          <div tabindex="0" class="focus:outline-none mb-7 bg-white p-6 shadow rounded">
            <div class="border-b border-gray-200 pb-6" >
              <div>
                <div class="pl-3">
                  <p class="focus:outline-none text-lg font-medium leading-5 text-gray-800"><%= link_to shift.title_date, shift_path(shift) %></p>
                  <p class="focus:outline-none text-sm leading-normal pt-2 text-gray-500">by 店長
              </div>
              </div>
            </div>
            <% shift.shortfalls.each_with_index do |shortfall, index| %>
              <% if shortfall.start_time.present? %>
                <div class="py-3 px-8 border border-gray-300 rounded-md shadow-sm bg-gray-50 mt-2 flex justify-between gap-1">
                  <p class="text-gray-700 font-semibold">
                    <%= "不足時間 #{index + 1} : " %>
                  </p>
                  <p class="text-gray-700 font-semibold">
                    <%= "#{shortfall.start_time&.strftime("%H:%M")} ~ #{shortfall.end_time&.strftime("%H:%M")}" %>
                  </p>
                  <p class="text-gray-700 font-semibold">
                    <%= "#{shortfall.require_count}名" %>
                  </p>
                </div>
              <% end %>
            <% end %>
            <div class="px-2">
              <p class="focus:outline-none text-sm leading-5 py-4 text-gray-600"><%= shift.comment %></p>
            </div>
          </div>
        </div>
      <% end %>
    <% else %>
      <div class="flex justify-center focus:outline-none mb-7 bg-white shadow rounded">
        <p class="text-base text-gray-700 p-5" >現在、募集しているシフトはありません。</p>
      </div>
    <% end %>
  </div>
  <% if admin_signed_in? %>
    <div class="col-span-3">
      <label class="block text-xl font-bold text-gray-700">
        <%= link_to "参加申請一覧", tickets_path %>
      </label>
      <div tabindex="0" aria-label="card 1" class="focus:outline-none mt-6 mb-3 bg-white shadow rounded">
        <ul>
          <% @tickets.select { |ticket| ticket.status == 'pending' }.each do |ticket| %>
            <% @allshifts.each do |shift| %>
              <% shift.shortfalls.each do |shortfall| %>
                <% if ticket.shortfall_id == shortfall.id %>
                  <div class="flex justify-around border-b border-gray-200 pb-4 pt-4">
                    <li>
                      <strong><%= ticket.user.firstname + " " + ticket.user.lastname %></strong>
                    </li>
                    <li>
                      <button class="text-sm bg-transparent text-green-700 py-1 px-3 border border-green-500 rounded">
                      承認待ち
                      </button>
                    </li>
                  </div>
                <% end %>
              <% end %>
            <% end %>
          <% end %>
          <% if @tickets.none? { |ticket| ticket.status == 'pending' } %>
            <div class="flex justify-center focus:outline-none bg-white shadow rounded">
              <p class="text-base text-gray-700 p-5" >現在、参加申請されているシフトはありません。</p>
            </div>
          <% end %>
        </ul>
      </div>
      <% if @tickets.any? %>
        <div class="text-right">
          <%= link_to "詳しく見る", tickets_path, class:"bg-blue-500 text-white py-1 px-4 rounded" %>
        </div>
      <% end %>
      
    </div>
  <% end %>
  
  <% if user_signed_in? %>
    <div class="space-y-6 col-span-3">
      <label class="block text-xl font-bold text-gray-700">参加申請中のシフト一覧</label>
      <div class="focus:outline-none mb-7 bg-white shadow rounded">
        <ul>
          <% @tickets.each do |ticket| %>
            <% @allshifts.each do |shift| %>
              <% shift.shortfalls.each do |shortfall| %>
                <% if ticket.shortfall_id == shortfall.id %>
                  <div class="flex justify-around items-center border-b border-gray-200 py-4 px-5">
                    <li>
                    <strong><%= shift.title_date %></strong>
                    </li>
                    <li>
                      <%= "#{shortfall.start_time&.strftime("%H:%M")} ~ #{shortfall.end_time&.strftime("%H:%M")}" %>
                    </li>
                    <li>
                      <% case ticket.status %>
                      <% when 'pending' %>
                        <p class="text-sm bg-transparent text-blue-700 py-1 px-3 border border-blue-500 rounded">
                        承認待ち
                        </p>
                      <% when 'approved' %>
                        <p class="text-sm bg-transparent text-green-700 py-1 px-3 border border-green-500 rounded">
                        承認済み
                        </p>
                      <% when 'rejected' %>
                        <p class="text-sm bg-transparent text-red-700 py-1 px-3 border border-red-500 rounded">
                        承認却下
                        </p>
                      <% end %>
                    </li>
                    <li>
                      <button id="delete-button" class="text-sm bg-blue-500 text-white py-1 px-2 rounded" >
                        確認
                      </button>
                      <div id="delete-modal" class="fixed inset-0 z-50 hidden bg-gray-800 bg-opacity-50 flex items-center justify-center">
                        <div class="bg-white rounded-lg shadow-lg w-96 p-6">
                          <h2 class="text-xl font-bold mb-4 text-gray-700">参加申請中のシフト一覧からこのシフトを削除しますか？</h2>
                          <p class="text-sm mb-4 text-red-700">（参加申請をキャンセルする場合は募集シフト一覧からキャンセル申請を行ってください）</p>
                          <div class="flex justify-end space-x-4">
                            <button type="button" id="modal-cancel" class="py-2 px-4 bg-gray-500 text-white rounded hover:bg-gray-700" >
                              キャンセル
                            </button>
                            <%= button_to "送信", shift_ticket_path(shift, ticket, type: "delete"), method: :delete, class: "py-2 px-4 bg-blue-500 text-white rounded hover:bg-blue-700" %>
                          </div>
                        </div>
                      </div>
                    </li>
                  </div>
                <% end %>
              <% end %>
            <% end %>
          <% end %>
          <% if @tickets.none? %>
            <div class="flex justify-center focus:outline-none mb-7 bg-white shadow rounded">
              <p class="text-base text-gray-700 p-5" >現在、参加申請されているシフトはありません。</p>
            </div>
          <% end %>
        </ul>
      </div>
    </div>
  <% end %>
</div>
